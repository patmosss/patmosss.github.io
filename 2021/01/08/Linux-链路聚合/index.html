<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>Linux-链路聚合 · Patmos</title><meta name="description" content="概念链路聚合：将多个物理端口汇聚在一起，形成一个逻辑端口，以实现流量的负载分担。
网卡的链路聚合就是将多个网卡绑定在一起，一张网卡损坏，网络依旧运行。
网卡的链路聚合一般常用的有“bond”“team”两种模式。“bond”最多可以添加两张网卡，“team”最多可以添加八张网卡。
一、bondbon"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.2"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Patmos</a></h3></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai </a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Linux-链路聚合</a></h3></div><div class="post-content"><h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>链路聚合：将多个物理端口汇聚在一起，形成一个逻辑端口，以实现流量的负载分担。</p>
<p>网卡的链路聚合就是将多个网卡绑定在一起，一张网卡损坏，网络依旧运行。</p>
<p>网卡的链路聚合一般常用的有<code>“bond”“team”</code>两种模式。<code>“bond”</code>最多可以添加两张网卡，<code>“team”</code>最多可以添加八张网卡。</p>
<h1 id="一、bond"><a href="#一、bond" class="headerlink" title="一、bond"></a>一、<code>bond</code></h1><h2 id="bond-的七种模式："><a href="#bond-的七种模式：" class="headerlink" title="bond 的七种模式："></a><code>bond</code> 的七种模式：</h2><ul>
<li><code>mode=0(balance-rr)(平衡抡循环策略)</code></li>
<li><code>mode=1(active-backup)(主-备份策略)</code></li>
<li><code>mode=2(balance-xor)(平衡策略)</code></li>
<li><code>mode=3(broadcast)(广播策略)</code></li>
<li><code>mode=4(802.3ad)(IEEE 802.3ad动态链路聚合)</code></li>
<li><code>mode=5(balance-tlb)(适配器传输负载均衡)</code></li>
<li><code>mode=6(balance-alb)(适配器适应性负载均衡)</code></li>
</ul>
<h2 id="1、查看目前的网卡的名称和状态"><a href="#1、查看目前的网卡的名称和状态" class="headerlink" title="1、查看目前的网卡的名称和状态"></a>1、查看目前的网卡的名称和状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# nmcli device status </span><br><span class="line">DEVICE  TYPE      STATE      CONNECTION </span><br><span class="line">ens32   ethernet  connected  ens32      </span><br><span class="line">ens34   ethernet  connected  ens34      </span><br><span class="line">ens35   ethernet  connected  ens35      </span><br><span class="line">lo      loopback  unmanaged  -- </span><br></pre></td></tr></table></figure>

<h2 id="2、创建-bond0-端口"><a href="#2、创建-bond0-端口" class="headerlink" title="2、创建 bond0 端口"></a>2、创建 <code>bond0</code> 端口</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add type bond con-name bond0 ifname bond0 ipv4.addresses 172.24.8.10/24 ipv4.gateway  172.25.8.254 ipv4.method manual</span><br></pre></td></tr></table></figure>

<h2 id="3、将接口-ens34-和-ens35-加入到-bond"><a href="#3、将接口-ens34-和-ens35-加入到-bond" class="headerlink" title="3、将接口 ens34 和 ens35 加入到 bond"></a>3、将接口 <code>ens34</code> 和 <code>ens35</code> 加入到 <code>bond</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add type bond-slave ifname ens34 con-name bond_port1 master bond0 </span><br><span class="line">nmcli connection add type bond-slave ifname ens35 con-name bond_port2 master bond0</span><br></pre></td></tr></table></figure>

<h2 id="4、启动"><a href="#4、启动" class="headerlink" title="4、启动"></a>4、启动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection up bond0</span><br></pre></td></tr></table></figure>

<h2 id="5、验证"><a href="#5、验证" class="headerlink" title="5、验证"></a>5、验证</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# ip addr show bond0 </span><br><span class="line">5: bond0: &lt;NO-CARRIER,BROADCAST,MULTICAST,MASTER,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 56:66:09:9f:fd:cb brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.24.8.10/24 brd 172.24.8.255 scope global noprefixroute bond0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">[root@test ~]# ip route </span><br><span class="line">default via 172.24.8.254 dev ens32 proto static metric 100 </span><br><span class="line">default via 172.25.8.254 dev bond0 proto static metric 300 </span><br><span class="line">172.24.8.0/24 dev ens32 proto kernel scope link src 172.24.8.138 metric 100 </span><br><span class="line">172.24.8.0/24 dev ens34 proto kernel scope link src 172.24.8.142 metric 101 </span><br><span class="line">172.24.8.0/24 dev ens35 proto kernel scope link src 172.24.8.141 metric 102 </span><br><span class="line">172.24.8.0/24 dev bond0 proto kernel scope link src 172.24.8.10 metric 300 </span><br><span class="line">172.25.8.254 dev bond0 proto static scope link metric 300</span><br></pre></td></tr></table></figure>

<h2 id="6、测试"><a href="#6、测试" class="headerlink" title="6、测试"></a>6、测试</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">断开一块网卡进行测试</span></span><br><span class="line">[root@test ~]# ifdown ens34</span><br></pre></td></tr></table></figure>



<h1 id="二、team"><a href="#二、team" class="headerlink" title="二、team"></a>二、<code>team</code></h1><h2 id="1、查看网卡的连接信息"><a href="#1、查看网卡的连接信息" class="headerlink" title="1、查看网卡的连接信息"></a>1、查看网卡的连接信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# nmcli connection show </span><br><span class="line">NAME   UUID                                  TYPE      DEVICE </span><br><span class="line">ens32  a4302588-30ea-4bc2-a8a8-00680c2c08d6  ethernet  ens32  </span><br><span class="line">ens34  150ea8a5-78d4-3495-a62f-79f12989d4f8  ethernet  ens34  </span><br><span class="line">ens35  0f677720-3221-3a8b-a86d-adec6fcf7b99  ethernet  ens35 </span><br></pre></td></tr></table></figure>

<h2 id="2、创建-team，名称为-team0"><a href="#2、创建-team，名称为-team0" class="headerlink" title="2、创建 team，名称为 team0"></a>2、创建 <code>team</code>，名称为 <code>team0</code></h2><p>按照下面的语法，用 <code>nmcli</code> 命令为网络组接口创建一个连接。</p>
<p><code># nmcli con add type team con-name CNAME ifname INAME [config JSON]</code></p>
<p><code>CNAME</code> 指代连接的名称，<code>INAME</code> 是接口名称，<code>JSON (JavaScript Object Notation)</code> 指定所使用的处理器(<code>runner</code>)。<code>JSON</code> 语法格式如下：</p>
<p><code>&#39;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;METHOD&quot;&#125;&#125;&#39;</code></p>
<p>METHOD 是以下的其中一个：<code>broadcast</code>、<code>activebackup</code>、<code>roundrobin</code>、<code>loadbalance</code> 或者 <code>lacp</code>。</p>
<p>最常见的双网卡绑定模式：<br>      （1） <code>roundrobin</code> - 轮询模式<br>所有链路处于负载均衡状态，这种模式的特点增加了带宽，同时支持容错能力。<br>      （2） <code>activebackup</code> - 主备模式<br>一个网卡处于活动状态，另一个处于备份状态，所有流量都在主链路上处理，当活动网卡 <code>down</code> 掉时，启用备份网卡。</p>
<p>这里我们创建<code>roundrobin</code>为例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# nmcli con add type team con-name team0 ifname team0 config &#x27;&#123;&quot;runner&quot;:&#123;&quot;name&quot;: &quot;roundrobin&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="3、设置-team0-的-ip、gateway、dns"><a href="#3、设置-team0-的-ip、gateway、dns" class="headerlink" title="3、设置 team0 的 ip、gateway、dns"></a>3、设置 <code>team0</code> 的 <code>ip</code>、<code>gateway</code>、<code>dns</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli con modify team0 ipv4.address 172.24.8.11/24 ipv4.gateway 172.24.8.254 </span><br><span class="line">nmcli connection modify team0 ipv4.dns 114.114.114.114</span><br></pre></td></tr></table></figure>

<h2 id="4、设置-team-的属性为-manual"><a href="#4、设置-team-的属性为-manual" class="headerlink" title="4、设置 team 的属性为 manual"></a>4、设置 <code>team</code> 的属性为 <code>manual</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli con modify team0 ipv4.method manual</span><br></pre></td></tr></table></figure>

<h2 id="5、添加网卡-ens34-、ens35-到-team0-中"><a href="#5、添加网卡-ens34-、ens35-到-team0-中" class="headerlink" title="5、添加网卡 ens34 、ens35 到 team0 中"></a>5、添加网卡 <code>ens34</code> 、<code>ens35</code> 到 <code>team0</code> 中</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli con add type team-slave con-name team0-port1 ifname ens34 master team0</span><br><span class="line"></span><br><span class="line">nmcli con add type team-slave con-name team0-port2 ifname ens35 master team0</span><br></pre></td></tr></table></figure>

<h2 id="6、启动-team0"><a href="#6、启动-team0" class="headerlink" title="6、启动 team0"></a>6、启动 <code>team0</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection up team0</span><br></pre></td></tr></table></figure>

<h2 id="7、查看-team0-状态"><a href="#7、查看-team0-状态" class="headerlink" title="7、查看 team0 状态"></a>7、查看 <code>team0</code> 状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# teamdctl team0 state view</span><br><span class="line">setup:</span><br><span class="line">  runner: roundrobin</span><br><span class="line">ports:</span><br><span class="line">  ens34</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">  ens35</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br></pre></td></tr></table></figure>

<p>通过以上就完成了通过 <code>nmcli</code> 创建 <code>roundrobin</code> 的网络 <code>team</code> </p>
<p>参考内容：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ghwzjz/article/details/109468437">https://blog.csdn.net/ghwzjz/article/details/109468437</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2021-01-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Linux/" title="Linux">Linux </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://patmosss.github.io/2021/01/08/Linux-链路聚合/,Patmos,Linux-链路聚合,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2021/01/21/Nignx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/" title="Nginx-配置详解">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2021/01/08/Hexo-GitHub-%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" title="Hexo+GitHub搭建博客">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>